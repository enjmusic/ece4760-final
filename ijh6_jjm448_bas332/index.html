<!DOCTYPE html>
<html>

<head>
	<title>Final Project Report - Wavetable Synthesizer</title>
	<link rel="stylesheet" href="style/default_style.css">
	<link rel="stylesheet" href="style/style.css">
	<link rel="icon" href="images/favicon.ico">
	<meta charset="UTF-8">
	<meta name="description" content="ECE 4760 Project by Ian Hoffman (ijh6), Joval Mathew (jjm448), and Balazs Szegletes (bas332)">
	<link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Lato:400,700" rel="stylesheet">
</head>

<body>
	<!-- TOP OF PAGE -->
	<div id="top"></div>

	<!-- PAGE HEADER -->
	<h1 id="title">
		ECE 4760 Final Project Report <br>
		Programmable Sequenced Wavetable Synthesizer

		<!-- IMAGES IN HEADER -->
		<img src="images/header_img_1.png" alt="waveform1" class="top-img" style="left: 7.5px;">
		<img src="images/header_img_2.png" alt="waveform2" class="top-img" style="right: 7.5px;">
	</h1>

	<br>

	<!-- AUTHORS -->
	<h2 class="section-header">Authors</h2>
	<br>
	<ul id="authors">
		<li>
			Ian Hoffman (ijh6)
		</li>
		<li>
			Joval Mathew (jjm448)
		</li>
		<li>
			Balazs Szegletes (bas332)
		</li>
	</ul>

	<br>

	<!-- PAGE TABLE OF CONTENTS -->
	<h2 class="section-header">Table of Contents</h2>
	<br>
	<ul id="table-of-contents">
		<li>
			<a href="#introduction">Introduction</a>
		</li>
		<li>
			<a href="#high-level">High-Level Design</a>
		</li>
		<li>
			<a href="#hardware-software-design">Hardware/Software Design</a>
		</li>
		<li>
			<a href="#results">Results</a>
		</li>
		<li>
			<a href="#conclusion">Conclusion</a>
		</li>
		<li>
			<a href="#appendix-a">Appendix A</a>
		</li>
		<li>
			<a href="#commented-program">Commented Program Files</a>
		</li>
		<li>
			<a href="#schematics">Schematics</a>
		</li>
		<li>
			<a href="#cost-details">Cost Details</a>
		</li>
		<li>
			<a href="#member-roles">Member Roles</a>
		</li>
		<li class="list-last">
			<a href="#references">References</a>
		</li>
	</ul>

	<br>
	<br>
	<br>

	<!-- PAGE SECTIONS -->
	<h2 class="section-header" id="introduction">Introduction</h2>
	<div class="report-section">
		<h3 class="subsection-header"> Soundbite </h3>
		<div class="subsection-content">
			For our final project, we created a wavetable synthesizer capable of playing back short user-programmable
			sequences with a large range of timbres.
		</div>
		<br>

		<h3 class="subsection-header"> Summary </h3>
		<div class="subsection-content">
			We decided to create a fun, easy-to-use wavetable synthesizer with just enough parameters 
			to offer a large sonic range, while limiting the controls to keep the user interface clean and 
			as unconfusing as possible. This goal was driven by the desire to make a useful product relevant 
			to the current digital synthesizer market, an area in which wavetable synthesis is very popular. 
			This method of synthesis allows for arbitrary waveforms, as well as blends of multiple waveforms, 
			allowing for a number of tones only limited by the storage capacity of the device. 
		</div>

		<!-- LINK TO TOP OF PAGE -->
		<a href="#top" class="top-link">TOP</a>
	</div>

	<!-- HIGH-LEVEL DESIGN -->
	<h2 class="section-header" id="high-level">High-Level Design</h2>
	<div class="report-section">
		<h3 class="subsection-header"> Rationale </h3>
		<div class="subsection-content">
			rationale text...
		</div>
		<br>

		<h3 class="subsection-header"> Logical Structure </h3>
		<div class="subsection-content">
			logical structure text...
		</div>
		<br>

		<h3 class="subsection-header"> Hardware/Software Tradeoffs </h3>
		<div class="subsection-content">
			hardware/software tradeoffs text...
		</div>
		<br>

		<h3 class="subsection-header"> Use of Existing Standards </h3>
		<div class="subsection-content">
			We did not use any common standards for this project. One possible standard we
			could have used, has this been a keyboard-controlled synthesizer, would be MIDI.
			However, since we generate and modify our 16-step sequence internally, it does
			not make sense to use the MIDI standard to represent note onsets, offsets, and
			pitches.
		</div>

		<!-- LINK TO TOP OF PAGE -->
		<a href="#top" class="top-link">TOP</a>
	</div>

	<!-- HARDWARE/SOFTWARE DESIGN -->
	<h2 class="section-header" id="hardware-software-design">Hardware/Software Design</h2>
	<div class="report-section">
		<h3 class="subsection-header"> Software Details </h3>
		<div class="subsection-content">
			program details text...
		</div>
		<br>

		<h3 class="subsection-header"> Hardware Details </h3>
		<div class="subsection-content">
			The hardware for the synthesizer is composed of a PIC32 microcontroller, 
			7 potentiometers, 4 buttons, an 8:1 analog multiplexer, a 12-bit DAC, 
			and a TFT display. Using user input from the various potentiometers and 
			buttons, the PIC then generates different sequences and waveforms based 
			upon the current inputs. 

			<br><br>

			A full hardware diagram can be found in the 
			<a class="external" href="#schematics">Schematics</a> 
			section.

			<br><br>

			Our TFT display is connected the way it has been for the previous labs, 
			using pins 4, 5, 6, 22, and 25. 

			<br><br>

			<!-- CONTROL FUNCTION TABLE -->
			<h3 class="diagram-label"> Button/Knob Control Functions </h3>
			<img src="images/control_uses.png" alt="controls" class="diagram-img">

			<!-- PIN CONNECTIONS TABLE -->
			<h3 class="diagram-label"> Pin Connections </h3>
			<img src="images/pin_connex.png" alt="connections" class="diagram-img">

			<br>

			The PIC32 then used direct digital synthesis running at 100 kHz to generate 
			the correct waveform specified by the input settings. The generation of  
			the waveform required the use of an external 12-bit DAC, the MCP4822.  
			The DAC has two output pins, VoutA and VoutB, of which we only use VoutA.  
			VoutB is sent to ground, along with Vss, and the LDAC pins. 

			 <br><br>

			The DAC is responsible for the main deliverable portion of our project, 
			and so it’s function is quite visible. However, the other main bit of 
			hardware in our setup is the CD4051b multiplexer, which takes input 
			signals from all of our potentiometers and relieves pressure on the PIC32’s 
			ADC capabilities. Most of the ADC pins on the PIC32 are taken up by the 
			TFT display, and so only four pins exist for our 7 analog inputs. 
			Clearly, even if we were to use all the ADC inputs, there would be a need 
			for multiplexing, as there would be three knobs unconnected. If we were 
			to use multiple ADC pins, then we would also have to re-configure the 
			ADC setup in order to multiplex between all the ADC pins. 

			<br><br>

			Under the hood, there exists only one ADC in the microcontroller, so it would be multiplexing 
			between all of the ADC pins, in addition to the multiplexing we would be 
			doing on each pin.The CD4051b then perfectly addresses our issue, due to 
			it having eight inputs, outputting a single line which would then use only 
			one ADC pin on the PIC32. Thanks to the multiplexer, we can keep the existing ADC 
			configuration. Although the multiplexer requires three extra channel inputs, 
			which are controlled by the PIC32, we have plenty more options for it, seeing 
			as they can be Digital Outputs, rather than Analog Inputs. The multiplexer itself 
			takes Vdd from the PIC32 power rail, and uses all the signal pins except 
			for Signal 5, which is grounded. The Vss, Vee, and INH pins are also sent 
			to ground. 

			<br><br>

			In order to stabilize the voltage output by the PIC32, we placed various 10µF 
			capacitors between power and ground on the hardware. This smoothes out 
			spikes and drops in the 3.3V output of the microcontroller. 


		</div>
		<br>

		<h3 class="subsection-header"> Preexisting Code </h3>
		<div class="subsection-content">
			All of the preexisting code we used was boilerplate code from the ECE 4760
			course website for setting up ISRs, DACs, I/O pins, and timers. We also 
			used the <a class="external" href="http://dunkels.com/adam/pt/"> Protothreads 
			</a> library by Adam Dunkels, and the tft_master.c/tft_gfx.c libraries 
			provided by Professor Land.
		</div>
		<br>

		<h3 class="subsection-header"> Roadblocks </h3>
		<div class="subsection-content">
			roadblocks (things that didn't work and how we fixed them) text...
		</div>

		<!-- LINK TO TOP OF PAGE -->
		<a href="#top" class="top-link">TOP</a>
	</div>

	<!-- RESULTS OF PROJECt -->
	<h2 class="section-header" id="results">Results</h2>
	<div class="report-section">

		<iframe src="https://www.youtube.com/embed/-MwzoiNMvcI" class="video" frameborder="0" allowfullscreen>
		</iframe><br>

		<h3 class="subsection-header"> Wave Tables </h3>
		<div class="subsection-content">
			wave table images here
		</div>
		<br>

		<h3 class="subsection-header"> Oscilloscope Captures </h3>
		<div class="subsection-content">
			scope shots here
		</div>
		<br>

		<h3 class="subsection-header"> Speed and Responsiveness </h3>
		<div class="subsection-content">
			analysis of speed and responsiveness here
		</div>
		<br>

		<h3 class="subsection-header"> Safety </h3>
		<div class="subsection-content">
			safety considerations here
		</div>
		<br>

		<h3 class="subsection-header"> Usability </h3>
		<div class="subsection-content">
			usability considerations here
		</div>

		<!-- LINK TO TOP OF PAGE -->
		<a href="#top" class="top-link">TOP</a>
	</div>

	<!-- CONCLUSION SECTION -->
	<h2 class="section-header" id="conclusion">Conclusion</h2>
	<div class="report-section">
		<h3 class="subsection-header"> Conformity to Initial Specification </h3>
		<div class="subsection-content">
			how different was our end product from original plan? what changes did we make?
		</div>
		<br>

		<h3 class="subsection-header"> Future Ideas </h3>
		<div class="subsection-content">
			things we would have liked to implement, had we had more time...
		</div>
		<br>

		<h3 class="subsection-header"> Intellectual Property Considerations </h3>
		<div class="subsection-content">
			intellectual property considerations text...
		</div>
		<br>

		<h3 class="subsection-header"> Ethical Considerations </h3>
		<div class="subsection-content">
			200 words or more, in reference to
			<a href="http://www.ieee.org/web/membership/ethics/code_ethics.html" class="external">
				IEEE code of ethics
			</a>
		</div>
		<br>

		<h3 class="subsection-header"> Legal Considerations </h3>
		<div class="subsection-content">
			legal considerations text...
		</div>

		<!-- LINK TO TOP OF PAGE -->
		<a href="#top" class="top-link">TOP</a>
	</div>

	<!-- APPENDIX A -->
	<h2 class="section-header" id="appendix-a">Appendix A</h2>
	<div class="report-section">
		The group approves this report and the YouTube video for inclusion on the course website.

		<!-- LINK TO TOP OF PAGE -->
		<a href="#top" class="top-link">TOP</a>
	</div>

	<!-- IMPORTANT PROGRAM FILES (ANNOTATED) -->
	<h2 class="section-header" id="commented-program">Commented Program Files</h2>
	<div class="report-section">
		<ul id="code-links">
			<li><a href="code/wavetable_master.c">
				wavetable_master.c <i> (main firmware file) </i>
			</a></li>
			<li><a href="code/convert.cpp">
				convert.cpp <i> (raw 32-bit binary audio to wavetable header conversion) </i>
			</a></li>
			<li><a href="code/env_bound_accum_calcs.rb">
				env_bound_accum_calcs.rb <i> (envelope keyframe phase accumulator calculations) </i>
			</a></li>
			<li><a href="code/freq_accum_calcs.rb">
				freq_accum_calcs.rb <i> (frequency phase accumulator calculations) </i>
			</a></li>
			<li><a href="code/tempo_accum_calcs.rb">
				tempo_accum_calcs.rb <i> (tempo phase accumulator calculations) </i>
			</a></li>
		</ul>

		<!-- LINK TO TOP OF PAGE -->
		<a href="#top" class="top-link">TOP</a>
	</div>

	<!-- BUILD SCHEMATICS -->
	<h2 class="section-header" id="schematics">Schematics</h2>
	<div class="report-section">
		<!-- HARDWARE/CIRCUIT DIAGRAM -->
		<h3 class="diagram-label"> Hardware/Circuit Diagram </h3>
		<img src="images/hardware_schematic.png" alt="circuit diagram" class="diagram-img">

		<!-- LINK TO TOP OF PAGE -->
		<a href="#top" class="top-link">TOP</a>
	</div>

	<!-- COSTS/BOM -->
	<h2 class="section-header" id="cost-details">Cost Details</h2>
	<div class="report-section">
		<b> Bill of Materials: </b>
		<br><br>

		<ul id="costs">
			<li> MicroStickII <b> ($10.00) </b> </li>
			<li> TFT LCD Display <b> ($10.00) </b> </li>
			<li> Solder Board x 2 <b> ($5.00) </b> </li>
			<li> Lab Speakers <b> ($2.00) </b> </li>
			<li> Tactile Switch x 4 <i> (Apem, Digikey Part #679-2428-ND) </i> <b> ($0.37) </b> </li>
			<li> Linear 10k Potentiometer x 7 <i> (TT Electronics/BI, Digikey Part #987-1277-ND) </i> <b> ($4.34) </b> </li>
			<li> MCP4822 12-Bit DAC <i> (Microchip Technology, Digikey Part #MCP4822-E/P-ND) </i> <b> ($3.00) </b> </li>
			<li> CD4051BE 8:1 Multiplexer <i> (Texas Instruments, Digikey Part #296-2057-5-ND) </i> <b> ($0.52) </b> </li>
		</ul>
		<br>

		<p>
			&nbsp; &nbsp;
			<b> Total cost: </b> $35.23
		</p>

		<!-- LINK TO TOP OF PAGE -->
		<a href="#top" class="top-link">TOP</a>
	</div>

	<!-- MEMBER ROLES -->
	<h2 class="section-header" id="member-roles">Member Roles</h2>
	<div class="report-section">
		<p>
			<b> Ian Hoffman </b> (ijh6)
			<br>
			<ul class="roles-list">
				<li> Software Development Lead </li>
				<li> Wavetable Creation/File Conversion </li>
				<li> Synthesis Parameter Calculation Scripting </li>
				<li> Diagramming </li>
				<li> Web Development </li>
			</ul>
		</p>
		<br>

		<p>
			<b> Joval Mathew </b> (jjm448)
			<br>
			<ul class="roles-list">
				<li> Hardware Prototyping/Design </li>
				<li> Board Layout/Soldering </li>
				<li> Software Development </li>
				<li> Project Organization and Management </li>
			</ul>
		</p>
		<br>

		<p>
			<b> Balazs Szegletes </b> (bas332)
			<br>
			<ul class="roles-list">
				<li> Hardware Prototyping/Design </li>
				<li> Board Layout/Soldering </li>
			</ul>
		</p>

		<!-- LINK TO TOP OF PAGE -->
		<a href="#top" class="top-link">TOP</a>
	</div>

	<!-- REFERENCES (MANUALS, ETC.) -->
	<h2 class="section-header" id="references">References</h2>
	<div class="report-section">
		<ul id="references">
			<li><a href="http://www.ti.com/lit/ds/symlink/cd4051b.pdf">
				Multiplexer Datasheet
			</a></li>
			<li><a href="http://people.ece.cornell.edu/land/courses/ece4760/labs/f2016/lab2_mcp4822.pdf"> 
				DAC Datasheet 
			</a></li>
			<li><a href="https://people.ece.cornell.edu/land/courses/ece4760/StudentWork/McNicoll/PIC32_Pinout_brl.pdf">
				PIC32 Pinout Diagram
			</a></li>
			<li><a href="http://ww1.microchip.com/downloads/en/DeviceDoc/32bitPeripheralLibraryGuide.pdf">
				PIC32 Peripheral Libraries Guide
			</a></li>
			<li><a href="http://www.microchip.com/design-centers/32-bit">
				PIC32 Reference Manual
			</a></li>
			<li><a href="https://people.ece.cornell.edu/land/courses/ece4760/PIC32/index_Protothreads.html">
				Protothreads on PIC32
			</a></li>
		</ul>

		<!-- LINK TO TOP OF PAGE -->
		<a href="#top" class="top-link">TOP</a>
	</div>
</body>

</html>